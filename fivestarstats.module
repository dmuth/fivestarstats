<?php
/**
* Fivestar Stats module.  This is used for determining voting statistics,
* as well as looking for abuse of the voting system.
*
* @author Douglas Muth <http://www.dmuth.org/>
*/

/**
* Create our menu.
*/
function fivestarstats_menu() {

	$retval = array();

	//
	// Our main menu item.
	//
	$retval["admin/settings/fivestarstats"] = array(
		"title" => "Fivestar Stats",
		"page callback" => "fivestarstats_main",
		"access arguments" => array("administer site configuration"),
		"type" => MENU_NORMAL_ITEM,
		
		);

	return($retval);

} // End of fivestarstats_menu()


/**
* Our permissions function.
* For now, we'll leave this empty.
*/
function fivestarstats_perm() {
	$retval = array();
	return($retval);
}


/**
* Our main function.  It returns the various reports.
*
* @return string The content of the page
*/
function fivestarstats_main() {

	$retval = "";

	$num = 10;

	$data = array();

	include("get_total_stats.inc.php");
	//$data["total"] = fivestarstats_get_total_stats();

	include("get_user_stats.inc.php");
	$data["users"] = fivestarstats_get_user_stats($num);

	include("get_ips.inc.php");
	//$data["ips"] = fivestarstats_get_ips($num);

	//$retval .= t("<b>Total Votes:</b> %num_votes from %num_ips unique IPs "
	//	. "with average of %num_stars stars.",
	//	array("%num_votes" => $num_votes, "%num_ips" => $num_ips, 
	//		"%num_stars" => $average_stars));

		//$retval .= "<li>" . l($row["name"], "user/" . $row["uid"]) . ": " 
		//	. t("%num posts", array("%num" => $row["cnt"]))
		//	. "</li>";

	//$retval .= "<h2>Top Posters (nodes and comments)</h2>";
	//$retval .= "<ul>";
	//$retval .= "</ul>";

$retval .= "<pre>" . print_r($data, true) . "</pre>";

/*
TODO:

Posts:
X Highest posters
X Vote average for each poster
X number/percentage of 1-star votes for each poster

IPs:
X Most active IPs
X Number/percentage of 1-star votes per IP
X Highest number of 1-star votes

Users:
- Top-rated users
- Lowest rated users
- Users with most 1-star votes (for abuse purposes)

*/

	return($retval);

} // End of fivestarstats_main()



